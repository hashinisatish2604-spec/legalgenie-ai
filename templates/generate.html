<!DOCTYPE html>
<html>
<head>
  <title>Generate Legal Document</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-900 text-white min-h-screen p-8">

<a href="/" class="text-yellow-400 font-semibold mb-6 inline-block">â¬… Back</a>

<h1 class="text-4xl text-yellow-400 mb-2">Generate Legal Document</h1>
<p class="text-slate-400 mb-4">Select a document type, language, and fill the form.</p>

<!-- ================= LANGUAGE SELECTOR ================= -->
<select id="language"
  class="mb-6 bg-slate-800 border border-slate-600 px-4 py-2 rounded">
  <option value="en">English</option>
  <option value="hi">Hindi</option>
  <option value="kn">Kannada</option>
</select>

<!-- ================= DOCUMENT CARDS ================= -->
<div class="grid grid-cols-4 gap-4 mb-10">

  <div class="card" onclick="loadForm('bail')">âš– Bail<br><span>Bail Application</span></div>
  <div class="card" onclick="loadForm('anticipatory')">ğŸ›¡ Shield<br><span>Anticipatory Bail</span></div>
  <div class="card" onclick="loadForm('fir')">ğŸš“ Police<br><span>FIR Draft</span></div>
  <div class="card" onclick="loadForm('affidavit')">ğŸ“„ Document<br><span>Affidavit</span></div>

  <div class="card" onclick="loadForm('rent')">ğŸ  Home<br><span>Rent Agreement</span></div>
  <div class="card" onclick="loadForm('will')">ğŸ“œ Will<br><span>Will</span></div>
  <div class="card" onclick="loadForm('poa')">âœ Signature<br><span>Power of Attorney</span></div>
  <div class="card" onclick="loadForm('custom')">â• Plus<br><span>Custom</span></div>

</div>

<h2 id="formTitle" class="text-2xl mb-4"></h2>
<div id="formFields" class="grid grid-cols-2 gap-6"></div>

<button onclick="generateDoc()"
  class="mt-8 bg-yellow-400 text-black px-8 py-3 rounded font-semibold">
  Generate Document
</button>

<style>
.card{
  background:#0f172a;
  border:1px solid #1e293b;
  padding:20px;
  border-radius:12px;
  cursor:pointer;
}
.card span{color:#94a3b8;font-size:14px}
.card:hover{border-color:#facc15}
.input{
  background:#1e293b;
  padding:10px;
  border-radius:6px;
  width:100%;
}
.textarea{
  background:#1e293b;
  padding:10px;
  border-radius:6px;
  width:100%;
  height:120px;
}
.mic{
  margin-top:6px;
  background:#facc15;
  color:black;
  padding:4px 10px;
  border-radius:6px;
}
</style>

<script>
let currentDoc = null;
let recognition = null;
let activeField = null;

if ("webkitSpeechRecognition" in window) {
  recognition = new webkitSpeechRecognition();
  recognition.lang = "en-IN";
  recognition.onresult = e => activeField.value = e.results[0][0].transcript;
}

function speakTo(id){
  activeField = document.getElementById(id);
  recognition.start();
}

/* ========= FORMS ========= */
const FORMS = {
  bail:{
    title:"Bail Application",
    fields:[
      "Court Name","Case Number","Police Station","Applicant Name",
      "Applicant Address","Accused Age","Offence","Sections",
      "Arrest Date","Facts","Grounds for Bail","Previous Bail Orders"
    ]
  },
  anticipatory:{
    title:"Anticipatory Bail",
    fields:[
      "Court Name","Applicant Name","FIR Number","Police Station",
      "Offence","Sections","Grounds","Reason for Apprehension"
    ]
  },
  fir:{
    title:"FIR Draft",
    fields:[
      "Police Station","FIR Number","Complainant Name",
      "Complainant Address","Accused Name","Incident Description",
      "Date of Incident","Time of Incident","Place of Incident"
    ]
  },
  affidavit:{
    title:"Affidavit",
    fields:[
      "Deponent Name","Age","Father/Mother Name","Address",
      "Occupation","Statement","Place","Date"
    ]
  },
  rent:{
    title:"Rent Agreement",
    fields:[
      "Landlord Name","Tenant Name","Property Address",
      "Purpose of Rent","Monthly Rent","Deposit",
      "Rent Start Date","Duration","Maintenance Charges"
    ]
  },
  will:{
    title:"Will",
    fields:[
      "Testator Name","Age","Address","Executor Name",
      "Beneficiaries","Assets Description","Witness 1","Witness 2"
    ]
  },
  poa:{
    title:"Power of Attorney",
    fields:[
      "Grantor Name","Grantee Name","Relationship",
      "Powers Granted","Property Details","Duration","Place"
    ]
  },
  custom:{
    title:"Custom Document",
    fields:[
      "Document Title","Document Description",
      "Additional Notes","Place","Date"
    ]
  }
};

function loadForm(type){
  currentDoc = type;
  formFields.innerHTML = "";
  formTitle.textContent = FORMS[type].title;

  FORMS[type].fields.forEach(f=>{
    const id = f.replace(/\s+/g,"_").toLowerCase();
    const isLong =
      f.includes("Facts") ||
      f.includes("Grounds") ||
      f.includes("Description") ||
      f.includes("Statement") ||
      f.includes("Notes") ||
      f.includes("Details");

    if(isLong){
      formFields.innerHTML += `
        <div class="col-span-2">
          <label>${f}</label>
          <textarea id="${id}" class="textarea"></textarea>
          <button class="mic" onclick="speakTo('${id}')">ğŸ¤ Speak</button>
        </div>`;
    } else {
      formFields.innerHTML += `
        <div>
          <label>${f}</label>
          <input id="${id}" class="input"/>
        </div>`;
    }
  });
}

async function generateDoc(){
  if(!currentDoc) return alert("Select a document type");

  const data = {};
  document.querySelectorAll("#formFields input, #formFields textarea")
    .forEach(i => data[i.id] = i.value);

  const res = await fetch("/generate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      doc_type: currentDoc,
      language: document.getElementById("language").value,
      form_data: data
    })
  });

  if (!res.ok) return alert("Document generation failed");

  const blob = await res.blob();
  const url = window.URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `${currentDoc}_document.docx`;
  document.body.appendChild(a);
  a.click();
  a.remove();

  window.URL.revokeObjectURL(url);
}
</script>

</body>
</html>
